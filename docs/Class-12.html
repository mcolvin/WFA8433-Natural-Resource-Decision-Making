<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Course home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Course information
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="index.html">Course home</a>
    </li>
    <li>
      <a href="syllabus.html">Course Syllabus</a>
    </li>
    <li>
      <a href="course-overview.html">Course Overview</a>
    </li>
    <li>
      <a href="final-project.html">About final project</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Classes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Class-01.html">Class 1: Introduction to decision making</a>
    </li>
    <li>
      <a href="Class-02.html">Class 2: The PrOACT Process</a>
    </li>
    <li>
      <a href="Class-03.html">Class 3: Uncertainty and decision making</a>
    </li>
    <li>
      <a href="Class-04.html">Class 4: Decision trees and nets</a>
    </li>
    <li>
      <a href="Class-05.html">Class 5: Intro to SDM and ARM</a>
    </li>
    <li>
      <a href="Class-06.html">Class 6: Structuring and quantifying objectives</a>
    </li>
    <li>
      <a href="Class-07.html">Class 7: Structuring objectives</a>
    </li>
    <li>
      <a href="Class-08.html">Class 8: Intro to R</a>
    </li>
    <li>
      <a href="Class-09.html">Class 9: Linear Models</a>
    </li>
    <li>
      <a href="Class-10.html">Class 10: LMs and GLMs</a>
    </li>
    <li>
      <a href="Class-11.html">Class 11: Prediction and GLMs</a>
    </li>
    <li>
      <a href="Class-12.html">Class 12: GLMs continued</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Additional Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="R-tutorials.html">R tutorials</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><!--

library(knitr)
rmarkdown::render_site("Class-12.Rmd")# build website

# rmarkdown::render_site()# build webpage
# COPY FILES TO DOCS FOR GITHUB.IO
system(paste("xcopy", 
    '"C:/Users/mcolvin/Documents/Teaching/WFA8433-Natural-Resource-Decision-Making/Course-Materials/_site"', 
    '"C:/Users/mcolvin/Documents/Teaching/WFA8433-Natural-Resource-Decision-Making/Docs"',
    "/E /C /H /R /K /O /Y")) 
  q(save="no") 
--></p>
<p><img src="media/banner-05.jpg" width="95%" /> <!--
Homework 1:  Introduction to basic computing- R
List of preliminary problems to instructor for review
--></p>
<div id="class-12.-glms-in-decision-contexts-continued" class="section level1">
<h1>Class 12. GLMs in Decision Contexts Continued</h1>
<ul>
<li>Supplemental background reading for next class(es): Conroy and Peterson Chapter 5.</li>
<li>Assignment due: None</li>
<li>Group work: Submit a concise summary of your proposed problem by 5 pm Friday. Email to me: <a href="mailto:michael.colvin@msstate.edu">michael.colvin@msstate.edu</a>, only 1 per group needed.</li>
<li>Link to class recording <a href="">Pending</a></li>
<li>Today’s R script <a href="scripts/Class-12.R">Class-12.R</a></li>
</ul>
<div id="objectives" class="section level2">
<h2>Objectives</h2>
<p>By the end of this tutorial you should be able to:</p>
<ol style="list-style-type: decimal">
<li>Understand generalized linear models (GLMs)</li>
<li>Understand logit and expit link functions</li>
<li>Predicting outcomes from GLMs</li>
<li>Using analysis in decision contexts</li>
</ol>
</div>
<div id="some-preliminaries" class="section level2">
<h2>Some preliminaries</h2>
<ul>
<li>If you want to play along in class download this zipfile <a href="http://mec685.cfr.msstate.edu/class-12.zip">*.zip</a>.</li>
<li>Be sure to unzip it before trying to use files and such</li>
<li>The file contains the dataset used in class and an R script of all the code.</li>
<li>Once you have it where you want open the R script and be sure to check the working directory <code>getwd()</code> and make sure it is where your folder is.</li>
<li>If your working directory is not correct, you can set it in Rstudio: “Session –&gt; Set Working Directory –&gt; To source file location”. Or you can use the <code>setwd()</code> in the console.</li>
</ul>
<pre class="r"><code>dat&lt;- read.csv(&quot;transport-mortality-data.csv&quot;)</code></pre>
<p>Take a look at the first couple of rows again and get a feel for what we are looking at.</p>
<pre class="r"><code>head(dat)</code></pre>
<pre><code>##   temperature   truck n_translocated n_survived
## 1         7.3 truck 2            442        140
## 2         9.0 truck 2            587        163
## 3         9.5 truck 2            410        114
## 4         3.3 truck 2            578        159
## 5         4.6 truck 1            461        127
## 6         5.2 truck 2            287         73</code></pre>
<p>OK, looks like it did last class, that is good. Recall we need to calculate the number of mortalities for the GLM to work correctly. That is done below.</p>
<pre class="r"><code>dat$n_mortalities&lt;- dat$n_translocated-dat$n_survived</code></pre>
<p>Now we can fit the model assuming the data has a binomial distribution. Recall the prediction model was:</p>
<p><span class="math display">\[\text{logit}(p) = \beta_{0}+
    \beta_{1}\cdot\text{Temperature}+
    \beta_{2}\cdot\text{Truck}+
    \beta_{3}\cdot\text{Temperature}\cdot\text{Truck}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\beta_{0}\)</span> is the intercept of the linear model<br />
</li>
<li><span class="math inline">\(\beta_{1}\)</span> is the effect of temperature</li>
<li><span class="math inline">\(\beta_{2}\)</span> is the effect of truck</li>
<li><span class="math inline">\(\beta_{3}\)</span> is the interaction of temperature and truck, and</li>
<li><span class="math inline">\(p\)</span> is the predicted survival</li>
</ul>
<p>And the statistical model linking the observed data to the linear model was:</p>
<p><span class="math display">\[\text{Number Survived}\sim Binomial(\text{Number Translocated},p)\]</span></p>
<p>where,</p>
<ul>
<li><span class="math inline">\(\text{Number Survived}\)</span> is the number of critters surviving translocation</li>
<li><span class="math inline">\(\text{Number Translocated}\)</span> is the number of critters translocated</li>
<li><span class="math inline">\(p\)</span> is the probability of success (i.e., survival)</li>
</ul>
<pre class="r"><code>fit&lt;-glm(cbind(n_survived,n_mortalities)~temperature+truck+temperature:truck,
    data=dat, family=&quot;binomial&quot;)</code></pre>
<p>We left off in the last class with using the <code>rbinom()</code> function to simulate many realizations of the binomial distribution given a number of critters to translocate and the probability of surviving. We made a new object <code>combos</code> using the <code>expand.grid()</code> function to generate all possible combinations of temperature, number of critters to translocate, and which truck. That code is below.</p>
<pre class="r"><code>combos&lt;- expand.grid(
    temperature=c(8,10,12,14),
    ntranslocate=c(100,250,500,1000),
    truck=c(&quot;truck 1&quot;,&quot;truck 2&quot;))
head(combos) # look at the combos</code></pre>
<pre><code>##   temperature ntranslocate   truck
## 1           8          100 truck 1
## 2          10          100 truck 1
## 3          12          100 truck 1
## 4          14          100 truck 1
## 5           8          250 truck 1
## 6          10          250 truck 1</code></pre>
<p>Recall we used the<code>predict()</code> function to make predictions from the fitted model and we specific that that <code>type=&quot;response&quot;</code> and not <code>type=&quot;link&quot;</code> because we want the actual probabilities and not the log odds (i.e., logit). Also recall that we could not get prediction intervals using the <code>predict()</code> function for a <code>glm()</code> but as we saw last time the we can pretty closely approximate it by simply simulating from the distribution. If we really really wanted to we could bootstrap it but that would take some time! The code below fits the <code>glm()</code> to the data assuming the data is binomially distributed.</p>
<pre class="r"><code>combos$S&lt;- predict(fit, # predict survival for each input combination
    newdata=combos,
    type=&quot;response&quot;)</code></pre>
<p>Now that we have the predicted survival we can simulate the expected outcomes for each combination. In this example the outcomes are the number of critters that survive the translocation. Now, we had 32 possible combinations to evaluate and as you recall we need to generate many values from <code>rbinom()</code> to begin to approximate the true distribution. Fortunately computers are good at this type of things so let’s give it a go.</p>
<p>First we need an object to hold all our values. A matrix will work well because I can preallocate it and fill it with 0s. Let’s do 10,000 replicates for each combo, so we will need a matrix with 32 and 10,000 columns to hold each replicate! The rows in the matrix correspond to each row in the <code>combos</code> <code>data.frame()</code>.</p>
<p>Let’s make that matrix.</p>
<pre class="r"><code>nsims&lt;- 10000
outcomes&lt;- matrix(0, # fill with 0s
    nrow=nrow(combos), # number of rows
    ncol=nsims) # number of columns</code></pre>
<p>Now that we have it made we can fill each row with replicate draws from the binomial distribution given how many critters we want to translocate and the predicted survival. We are going to use the for <code>for()</code> function to loop over each row of <code>combos</code> and extract the predicted survival and number of critters to translocate to use as inputs to <code>rbinom()</code>.</p>
<pre class="r"><code>for(i in 1:nrow(combos))
    {
    S&lt;- combos$S[i]
    Nt&lt;- combos$ntranslocate[i]
    outcomes[i,]&lt;-rbinom(nsims,Nt, S)
    }</code></pre>
<p>Now that is done we can look at the outcomes using hist. Below are the expectations for the 32nd combination.</p>
<pre class="r"><code>hist(outcomes[32,])  </code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>And we can calculate the probability of each outcome.</p>
<pre class="r"><code>table(outcomes[32,])/nsims</code></pre>
<pre><code>## 
##    266    274    275    276    277    278    279    280    281    282 
## 0.0001 0.0001 0.0001 0.0001 0.0002 0.0004 0.0003 0.0001 0.0005 0.0002 
##    283    284    285    286    287    288    289    290    291    292 
## 0.0002 0.0006 0.0009 0.0015 0.0008 0.0024 0.0015 0.0021 0.0023 0.0027 
##    293    294    295    296    297    298    299    300    301    302 
## 0.0020 0.0039 0.0039 0.0049 0.0057 0.0069 0.0071 0.0083 0.0087 0.0111 
##    303    304    305    306    307    308    309    310    311    312 
## 0.0108 0.0098 0.0117 0.0133 0.0155 0.0159 0.0153 0.0183 0.0185 0.0211 
##    313    314    315    316    317    318    319    320    321    322 
## 0.0198 0.0223 0.0211 0.0227 0.0235 0.0267 0.0277 0.0255 0.0259 0.0271 
##    323    324    325    326    327    328    329    330    331    332 
## 0.0287 0.0261 0.0253 0.0261 0.0239 0.0266 0.0268 0.0242 0.0207 0.0218 
##    333    334    335    336    337    338    339    340    341    342 
## 0.0229 0.0209 0.0214 0.0175 0.0179 0.0145 0.0172 0.0161 0.0145 0.0110 
##    343    344    345    346    347    348    349    350    351    352 
## 0.0115 0.0095 0.0092 0.0084 0.0078 0.0053 0.0072 0.0051 0.0068 0.0055 
##    353    354    355    356    357    358    359    360    361    362 
## 0.0036 0.0038 0.0026 0.0026 0.0019 0.0016 0.0019 0.0013 0.0010 0.0018 
##    363    364    365    366    367    368    369    371    372    373 
## 0.0010 0.0010 0.0009 0.0006 0.0001 0.0005 0.0001 0.0005 0.0002 0.0001 
##    374    375    376    383 
## 0.0001 0.0001 0.0001 0.0001</code></pre>
<p>Now, there are quite a few possible outcomes. The number of survivors varies from 9 to 384. If we put that together as a decision tree, it would start with 32 branches and have an additional 375 outcomes for each of those branches. Take it from me, it will be a big tree! If you are bored, make that tree and hang it on your fridge.</p>
<div id="a-decision-model" class="section level3">
<h3>A decision model</h3>
<p>Fortunately a tool like Netica and help out here. We take the predictive model and statistical model an implement them in Netica to develop a formal decision making process. In this context we might be interest in which truck to use to translocate our critters so we maximize survival. This model looks like the image below.</p>
<p><img src="media/cl12-translocation-network.png" width="95%" /></p>
<p>There is a whole lot being consolidated into 4 nature notes! Let’s dig a bit deeper into this. The part of the model below highlights the predictive model. Recall it was</p>
<p><span class="math display">\[\text{logit}(p) = \beta_{0}+
    \beta_{1}\cdot\text{Temperature}+
    \beta_{2}\cdot\text{Truck}+
    \beta_{3}\cdot\text{Temperature}\cdot\text{Truck}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\beta_{0}\)</span> is the intercept of the linear model<br />
</li>
<li><span class="math inline">\(\beta_{1}\)</span> is the effect of temperature</li>
<li><span class="math inline">\(\beta_{2}\)</span> is the effect of truck</li>
<li><span class="math inline">\(\beta_{3}\)</span> is the interaction of temperature and truck, and</li>
<li><span class="math inline">\(p\)</span> is the predicted survival</li>
</ul>
<p>The BDN below shows the inputs temperature and truck as predicting survival.</p>
<p><img src="media/cl12-translocation-network-02.png" width="95%" /></p>
<p>But I don’t see where the <span class="math inline">\(\beta\)</span>s are? I mean I fit the model and all, so how are they used to predict survival? Well that is because I was able to specify the equation in Netica, it is not pretty but it is pretty doable if you do it in chunks.</p>
<p><img src="media/cl12-translocation-network-02a.png" width="45%" /></p>
<p>The dialog box specifies what survival is depending on temperature and what truck is used!</p>
<p>In the figure below we have that statistical model highlighted. Recall it was <span class="math display">\[\text{Number Survived}\sim Binomial(\text{Number Translocated},p)\]</span></p>
<p>where,</p>
<ul>
<li><span class="math inline">\(\text{Number Survived}\)</span> is the number of critters surviving translocation</li>
<li><span class="math inline">\(\text{Number Translocated}\)</span> is the number of critters translocated</li>
<li><span class="math inline">\(p\)</span> is the probability of success (i.e., survival)</li>
</ul>
<p>Well that seems to jive with the inputs below! Cool beans.</p>
<p><img src="media/cl12-translocation-network-03.png" width="95%" /></p>
<p>Just like with survival there is an equation that calculates the probability of the outcomes, number surviving, given survival and the number of critters to translocate.</p>
<p><img src="media/cl12-translocation-network-03a.png" width="45%" /></p>
<p>Hopefully this has you thinking that you might be able to find information that can link to the temperature node, for example, you might be able to use information on the average temperature from the day before to predict whate the temperature might be. As we move along we will actually look at a way of quantifying how valuable that information might be. But for now we will return to leaning about 2 more GLMs as these are important tools to link system states (inputs) to expected outcomes.</p>
</div>
<div id="bernoulli" class="section level3">
<h3>Bernoulli</h3>
<p>The next distributional family we will look at is the Bernoulli which is very similar to the binomial. You can think of it as a binomial but with only 1 trial and therefore the outcomes are restricted to 0 and 1. We see this distribution in ecology associated with quantities that can be one of 2 possible outcomes such as</p>
<ul>
<li>Present or absent</li>
<li>Infected or uninfected</li>
<li>Mature or immature</li>
<li>Male or female</li>
</ul>
<p>you get the drift. Each outcome above can be coded as a 0 or 1 and the probability of being a 0 or 1 modeled using a linear model. Specifically the model is: the predictive model was:</p>
<p><span class="math display">\[\text{logit}(p) = \beta_0 + \beta_i\cdot X_i \]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\beta_{0}\)</span> is the model intercept,</li>
<li><span class="math inline">\(\beta_{i}\)</span> is the effect of covariate <span class="math inline">\(i\)</span>,</li>
<li><span class="math inline">\(X_i\)</span> is a matrix of predictor covariates</li>
<li><span class="math inline">\(i\)</span> indexes each covariate.</li>
</ul>
<p>The link the prediction to data using a statistical model to account for uncertainty as:</p>
<p><span class="math display">\[Y_i \sim Bernoulli(p)\]</span></p>
<ul>
<li><span class="math inline">\(Y_i\)</span> is the observed values</li>
<li><span class="math inline">\(p\)</span> is the probability of success (i.e., 1)</li>
</ul>
<p>Now this should look very familiar to the Binomial model we worked with in the last class. In fact, <span class="math inline">\(Bernoulli(p) = Binomial(1,p)\)</span>! Don’t believe me? Let’s verify it with a quick simulation. Let’s try simulating a probability of success of 0.3.</p>
<p>Using the binomial we can simulation 100 outcomes using the code below.</p>
<pre class="r"><code>success&lt;- rbinom(n=100,size=1,prob=0.3)</code></pre>
<p>If all went to plan there should be about 30 success. Let’s confirm</p>
<pre class="r"><code>table(success)</code></pre>
<pre><code>## success
##  0  1 
## 65 35</code></pre>
<p>Nice, about 30 successes were returned per 100 independent trials.</p>
<p>Now there is no corresponding <code>rbernoulli()</code> or <code>rbern()</code> function in R because they are the same as <code>rbinom()</code> with <code>size=1</code>.</p>
<div id="the-data" class="section level4">
<h4>The data</h4>
<p>Continuing with our translocation example from before, suppose after translocation the population was monitored to see if the translocation was successful. In this case success was defined as detecting 2 reproductive critters one year post translocation.</p>
<p>There are some factors that likely influence whether the translocation was successful. For example, if you translocate more critters then you are more likely to have a successful translocation. Also, the previous example looked at short term mortality of translocation using the binomial, however there may be delayed effects due to stressful conditions encountered during the translocation event.</p>
<p>The data below represents data that one would expect if a conservation translocation operation had been operating for a while. Actually, the data matches up to our previous dataset. Except we have a couple of new columns of data. The first column specifies whether that translocation was successful or not, 1 or 0 respectively. Also included in the dataset is the habitat type where the critters were released which has 3 levels: forest, field, and swamp.</p>
<pre class="r"><code>dat&lt;- read.csv(&quot;translocation-success-data.csv&quot;)</code></pre>
<p>As usual let’s take a look at the data and make sure things are ok.</p>
<pre class="r"><code>head(dat)</code></pre>
<pre><code>##   temperature   truck n_translocated n_survived habitat success
## 1         7.3 truck 2            442        140   swamp       1
## 2         9.0 truck 2            587        163   field       0
## 3         9.5 truck 2            410        114   field       0
## 4         3.3 truck 2            578        159  forest       0
## 5         4.6 truck 1            461        127  forest       0
## 6         5.2 truck 2            287         73   swamp       0</code></pre>
<pre class="r"><code>str(dat)</code></pre>
<pre><code>## &#39;data.frame&#39;:    200 obs. of  6 variables:
##  $ temperature   : num  7.3 9 9.5 3.3 4.6 5.2 3.4 5.2 3.9 4.8 ...
##  $ truck         : Factor w/ 2 levels &quot;truck 1&quot;,&quot;truck 2&quot;: 2 2 2 2 1 2 2 1 1 2 ...
##  $ n_translocated: int  442 587 410 578 461 287 202 648 329 224 ...
##  $ n_survived    : int  140 163 114 159 127 73 63 213 92 54 ...
##  $ habitat       : Factor w/ 3 levels &quot;field&quot;,&quot;forest&quot;,..: 3 1 1 2 2 3 1 2 3 2 ...
##  $ success       : int  1 0 0 0 0 0 0 0 1 0 ...</code></pre>
<p>Things look good we have a new factor for <code>habitat</code> and a field for <code>success</code>.</p>
<p>We can look at the data with our plot function. Let’s see if we can see anything with success.</p>
<pre class="r"><code>plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-22-1.png" width="672" /> Well that was not very helpful. But it does show that we do not have to deal with complete separation issues. I know you are all probably thinking separation issues only occur when you are away from your computer for too long, but in this case if there is no overlap between the 0s and 1s with the covariate we will not be able to fit the model.</p>
<p>Let’s try to look at each habitat on a plot. We can use the subset argument in the plot function to look at each habitat. To keep them all straight I am going to add a title to them.</p>
<pre class="r"><code>plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;forest&quot;,
    main=&quot;Forest&quot;)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-23-1.png" width="672" /> Now lets look at field habitat.</p>
<pre class="r"><code>plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;field&quot;,
    main=&quot;Field&quot;)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-24-1.png" width="672" /> And finally we can look at swamp.</p>
<pre class="r"><code>plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;swamp&quot;,
    main=&quot;Swamp&quot;)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Let’s use our points function to overlay the different habitat types. First we make a blank plot using the argument <code>type=&quot;n&quot;</code> and then overlay our varying habitats using the <code>points()</code> function.</p>
<pre class="r"><code>plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    type=&quot;n&quot;)
points(success~n_survived,data=dat,
      subset=habitat==&quot;forest&quot;,
      col=&quot;blue&quot;)
points(success~n_survived,data=dat,
      subset=habitat==&quot;field&quot;,
      col=&quot;red&quot;)
points(success~n_survived,data=dat,
      subset=habitat==&quot;swamp&quot;,
      col=&quot;green&quot;)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Well that is not super helpful either.</p>
<p>Can we plot multiple panels on the same plot? Yes, I am gladd you asked. We can use the <code>par()</code> function to tell <code>R</code> to plot several plots on the same plot area. Specifically, the <code>mfrow</code> argument will allow us to specify how many row and columns to plot. Let’s make each plot in 3 rows and 1 column.</p>
<pre class="r"><code>par(mfrow=c(3,1))
plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;forest&quot;)
plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;field&quot;)
 plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;swamp&quot;)  </code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Well we can start to see some patterns here. Forest looks to be only successful if there are lots of critters translocated. swampy areas have success over a wide range of numbers stocked.</p>
<p>Those plots are hard to read though. With some tweaking we can adjust things to make them a bit more pleasant. First thing we need to adjust is the margins around each plot using the <code>mar</code> argument</p>
<pre class="r"><code>par(mfrow=c(3,1),mar=c(1,1,1,1))
plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;forest&quot;)
plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;field&quot;)
 plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;swamp&quot;)  </code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Well that is better, but I lost my labels. What do the 4 numbers mean anyways? Well they indicate the margin size starting at the bottom (x-axis) and move clockwise around so that 2 is the y-axis, 3 is the top, and 4 is the left margin. If was want to increase the bottom and right margins a bit we can change the first and second element in the <code>mar</code> argument.</p>
<pre class="r"><code>par(mfrow=c(3,1),mar=c(6,6,1,1))
plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;forest&quot;)
plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;field&quot;)
 plot(success~n_survived,data=dat,
    xlab=&quot;Number survived&quot;,
    ylab=&quot;Translocation success&quot;,
    subset=habitat==&quot;swamp&quot;)  </code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>That is better, but my axis labels are gross and redundant. We can add a little bit of outer margin and add some text to that to make them not so gross using the <code>oma</code> argument. And we can then use the <code>mtext()</code> function to add some text in that new margin area.</p>
<pre class="r"><code>par(mfrow=c(3,1),mar=c(1,1,1,1),oma=c(3,3,1,1))
plot(success~n_survived,data=dat,
    xlab=&quot;&quot;,
    ylab=&quot;&quot;,
    subset=habitat==&quot;forest&quot;)
plot(success~n_survived,data=dat,
    xlab=&quot;&quot;,
    ylab=&quot;&quot;,
    subset=habitat==&quot;field&quot;)
plot(success~n_survived,data=dat,
    xlab=&quot;&quot;,
    ylab=&quot;&quot;,
    subset=habitat==&quot;swamp&quot;)  
mtext(text=&quot;Number survived&quot;,
    side=1,# plot on the bottom outer margin
    line=1,# what line to plot on 
    outer=TRUE) # plot in the outer margin
mtext(text=&quot;Translocation success&quot;,
    side=2, # plot on the left outer margin
    line=1, # what line to plot on 
    outer=TRUE) # plot in the outer margin</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>With tweaking you can get some really good graphics. Let’s move on to the model.</p>
</div>
<div id="model" class="section level4">
<h4>model</h4>
<p>Here we are going to fit a model to the 0s and 1s, success in the dataset. Specifically we are going to fit the predictive model</p>
<p><span class="math display">\[\text{logit}(p) = \beta_0 + \beta_1\cdot \text{Survivors} + 
    \beta_2\cdot\text{Truck} +
    \beta_3\cdot\text{Habitat}\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\beta_{0}\)</span> is the model intercept,</li>
<li><span class="math inline">\(\beta_{1}\)</span> is the effect of the number of critters translocated</li>
<li><span class="math inline">\(\beta_{2}\)</span> is the effect of truck indicating a delayed mortality</li>
<li><span class="math inline">\(\beta_{3}\)</span> is the effect of habitat the critter was stocked into</li>
</ul>
<p>The link the prediction to data using a statistical model to account for uncertainty as:</p>
<p><span class="math display">\[Y_i \sim Bernoulli(p)\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(Y_i\)</span> is the observed values</li>
<li><span class="math inline">\(p\)</span> is the probability of translocation success (i.e., 1)</li>
</ul>
</div>
<div id="fitting" class="section level4">
<h4>fitting</h4>
<p>We fit that model as before using the<code>glm()</code> function.</p>
<pre class="r"><code>fit&lt;- glm(success~n_survived+truck+habitat,
    data=dat,
    family=&quot;binomial&quot;)</code></pre>
<p>In this case we did not have to use the <code>cbind()</code> function to bind the successes and failures together, the function interpreted the 0s as failures and the 1s as successes for us. We can do all the cool things as before like using <code>summary()</code>, <code>coef()</code>, and so on.</p>
<pre class="r"><code>summary(fit)</code></pre>
<pre><code>## 
## Call:
## glm(formula = success ~ n_survived + truck + habitat, family = &quot;binomial&quot;, 
##     data = dat)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3522  -0.6624  -0.2215   0.6603   2.2767  
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -4.918664   0.848517  -5.797 6.76e-09 ***
## n_survived     0.027509   0.004073   6.754 1.43e-11 ***
## trucktruck 2  -1.465170   0.420154  -3.487 0.000488 ***
## habitatforest -0.884348   0.504305  -1.754 0.079499 .  
## habitatswamp   0.176692   0.504056   0.351 0.725933    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 258.98  on 199  degrees of freedom
## Residual deviance: 161.15  on 195  degrees of freedom
## AIC: 171.15
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>We have a nice summary of the effects and the estimates of the <span class="math inline">\(\beta\)</span>s. We can extract those.</p>
<pre class="r"><code>betas&lt;- coef(fit)</code></pre>
<p>The summary provides p-values, which are nice, but some analysis prefer confidence intervals of the parameter estimates. We can calculate those using the <code>confint()</code> function.</p>
<pre class="r"><code>confint(fit)</code></pre>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                     2.5 %      97.5 %
## (Intercept)   -6.72100358 -3.37363619
## n_survived     0.02016248  0.03623853
## trucktruck 2  -2.32470553 -0.66777609
## habitatforest -1.90139203  0.08820573
## habitatswamp  -0.81033150  1.17722193</code></pre>
<p>This approach profiles the likelihood, see Hilborn and Mangel’s Ecological Detective if you are interested in this. Regardless we can see most estimates are reasonably precise and do not overlap 0. Habitat is a bit suspect, but we are going to roll with it.</p>
<p>We can get things like residuals and fitted values.</p>
<pre class="r"><code>dat$residuals&lt;- resid(fit)
dat$fitted&lt;- fitted(fit)</code></pre>
<p>And now we can look at them.</p>
<pre class="r"><code>plot(residuals~fitted,
    data=dat)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-36-1.png" width="672" /> Well that is weird, but it illustrates there only 2 outcomes, 0 or 1. The plot of predicted to observed is equally weird and not really any use.</p>
<pre class="r"><code>plot(success~fitted,
    data=dat)</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-37-1.png" width="672" /> The take home here is that it is difficult to evaluate binary outcomes, but you can look at things like receiver operator curves to see if the model does better than chance and other goodness of fit measures..</p>
</div>
<div id="predictions" class="section level4">
<h4>Predictions</h4>
<p>We can make predictions just as we did before using the <code>predict()</code> function. First we need to make a dataset to predict from. The <code>expand.grid()</code> function worked well before to get all possible combinations, let’s use that again.</p>
<pre class="r"><code>preddat&lt;- expand.grid(
    truck=c(&quot;truck 1&quot;, &quot;truck 2&quot;),
    n_survived=c(min(dat$n_survived):max(dat$n_survived)),
    habitat=c(&quot;forest&quot;,&quot;field&quot;,&quot;swamp&quot;))
head(preddat)</code></pre>
<pre><code>##     truck n_survived habitat
## 1 truck 1         54  forest
## 2 truck 2         54  forest
## 3 truck 1         55  forest
## 4 truck 2         55  forest
## 5 truck 1         56  forest
## 6 truck 2         56  forest</code></pre>
<p>And then feed the new data to the <code>predict()</code> function.</p>
<pre class="r"><code>preddat$pred&lt;- predict(fit, newdata=preddat,
    type=&quot;response&quot;)# get probabilities, not log odds</code></pre>
<p>To help visualize what is going on we can plot the prediction.</p>
<pre class="r"><code>plot(pred~n_survived,preddat,type=&quot;n&quot;,
    xlab=&quot;Number surviving&quot;,
    ylab=&quot;Probability of success&quot;,
    las=1)
points(pred~n_survived,preddat,
    subset=truck==&quot;truck 1&quot; &amp; habitat ==&quot;forest&quot;,
    lty=1,type=&quot;l&quot;)
points(pred~n_survived,preddat,
    subset=truck==&quot;truck 2&quot; &amp; habitat ==&quot;forest&quot;,
    lty=2,type=&quot;l&quot;)    
points(pred~n_survived,preddat,
    subset=truck==&quot;truck 1&quot; &amp; habitat ==&quot;field&quot;,
    lty=1,col=&quot;darkgrey&quot;,type=&quot;l&quot;)
points(pred~n_survived,preddat,
    subset=truck==&quot;truck 2&quot; &amp; habitat ==&quot;field&quot;,
    lty=2,col=&quot;darkgrey&quot;,type=&quot;l&quot;)      
 points(pred~n_survived,preddat,
    subset=truck==&quot;truck 1&quot; &amp; habitat ==&quot;swamp&quot;,
    lty=1,col=&quot;lightgrey&quot;,type=&quot;l&quot;)
points(pred~n_survived,preddat,
    subset=truck==&quot;truck 2&quot; &amp; habitat ==&quot;swamp&quot;,
    lty=2,col=&quot;lightgrey&quot;,type=&quot;l&quot;)    
# PUT A LEGEND ON THIS AND CALL IT A NIGHT!    
legend(&quot;topleft&quot;,c(&quot;Forest Truck 1&quot;,&quot;Forest Truck 2&quot;,
    &quot;Field Truck 1&quot;,&quot;Field Truck 2&quot;,
    &quot;Swamp Truck 1&quot;,&quot;Swamp Truck 2&quot;),
    col=c(&quot;black&quot;,&quot;black&quot;,
        &quot;darkgrey&quot;,&quot;darkgrey&quot;,
        &quot;lightgrey&quot;,&quot;lightgrey&quot;),lty=c(1,2))</code></pre>
<p><img src="Class-12_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>One nice thing about the binomial is that we can directly interpret the outcomes.</p>
<pre class="r"><code>preddat[preddat$n_survived==200,]</code></pre>
<pre><code>##        truck n_survived habitat      pred
## 293  truck 1        200  forest 0.4252848
## 294  truck 2        200  forest 0.1460049
## 839  truck 1        200   field 0.6418108
## 840  truck 2        200   field 0.2927764
## 1385 truck 1        200   swamp 0.6813373
## 1386 truck 2        200   swamp 0.3306503</code></pre>
<p>Looks like the effect of truck 2 is pretty significant. We can also add our new model to our existing decision network, like the figure below.</p>
<p><img src="media/cl12-translocation-network-04.png" width="95%" /></p>
</div>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
