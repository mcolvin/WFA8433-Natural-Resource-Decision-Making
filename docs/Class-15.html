<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/textmate.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Course home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Course information
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="index.html">Course home</a>
    </li>
    <li>
      <a href="syllabus.html">Course Syllabus</a>
    </li>
    <li>
      <a href="course-overview.html">Course Overview</a>
    </li>
    <li>
      <a href="final-project.html">About final project</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Classes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Class-01.html">Class 1: Introduction to decision making</a>
    </li>
    <li>
      <a href="Class-02.html">Class 2: The PrOACT Process</a>
    </li>
    <li>
      <a href="Class-03.html">Class 3: Uncertainty and decision making</a>
    </li>
    <li>
      <a href="Class-04.html">Class 4: Decision trees and nets</a>
    </li>
    <li>
      <a href="Class-05.html">Class 5: Intro to SDM and ARM</a>
    </li>
    <li>
      <a href="Class-06.html">Class 6: Structuring and quantifying objectives</a>
    </li>
    <li>
      <a href="Class-07.html">Class 7: Structuring objectives</a>
    </li>
    <li>
      <a href="Class-08.html">Class 8: Intro to R</a>
    </li>
    <li>
      <a href="Class-09.html">Class 9: Linear Models</a>
    </li>
    <li>
      <a href="Class-10.html">Class 10: LMs and GLMs</a>
    </li>
    <li>
      <a href="Class-11.html">Class 11: Prediction and GLMs</a>
    </li>
    <li>
      <a href="Class-12.html">Class 12: GLMs continued</a>
    </li>
    <li>
      <a href="Class-13.html">Class 13: Poissons</a>
    </li>
    <li>
      <a href="Class-14.html">Class 14: HLMs</a>
    </li>
    <li>
      <a href="Class-15.html">Class 15: HLMs and occupancy</a>
    </li>
    <li>
      <a href="Class-16.html">Class 16: Occupancy continued</a>
    </li>
    <li>
      <a href="Class-17.html">Class 17: Influence diagrams, Sensitivity analyses &amp; N-Mixtures</a>
    </li>
    <li>
      <a href="Class-18.html">Class 18: N-Mixtures &amp; Estimating abundance</a>
    </li>
    <li>
      <a href="Class-19.html">Class 19: Population dynamics and decisions</a>
    </li>
    <li>
      <a href="Class-20.html">Class 20</a>
    </li>
    <li>
      <a href="Class-21.html">Class 21</a>
    </li>
    <li>
      <a href="Class-22.html">Class 22: ARM</a>
    </li>
    <li>
      <a href="Class-23.html">Class 23: ARM continued</a>
    </li>
    <li>
      <a href="Class-24.html">Class 24: Expert elicitation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="hw-01.html">Homework 1</a>
    </li>
    <li>
      <a href="hw-02.html">Homework 2</a>
    </li>
    <li>
      <a href="hw-03.html">Homework 3</a>
    </li>
    <li>
      <a href="hw-04.html">Homework 4</a>
    </li>
    <li>
      <a href="hw-05.html">Homework 5</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Additional Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="R-tutorials.html">R tutorials</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><!--

library(knitr)
rmarkdown::render_site("Class-15.Rmd")# build website
# rmarkdown::render_site()# build webpage
# COPY FILES TO DOCS FOR GITHUB.IO
system(paste("xcopy",'"C:/Users/mcolvin/Documents/Teaching/WFA8433-Natural-Resource-Decision-Making/Course-Materials/_site"',     '"C:/Users/mcolvin/Documents/Teaching/WFA8433-Natural-Resource-Decision-Making/Docs"',     "/E /C /H /R /K /O /Y")) 
q(save="no") 

rmarkdown::render_site()# build webpage
## PURL R CODE FROM CLASS NOTES
p<- knitr::purl("Class-15.Rmd")
knitr::read_chunk(p)
chunks <- knitr:::knit_code$get()
chunkss<- lapply(1:length(chunks),function(x){if(!(names(chunks[x]) %in% c("echo=FALSE" ,"eval=FALSE"))){c(paste0("## ----", names(chunks)[x] ,"---- ##"),chunks[[x]]," "," "," ")}})
xxx<- unlist(chunkss);
writeLines(xxx,"./scripts/Class-15.R")
system(paste("xcopy",'"C:/Users/mcolvin/Documents/Teaching/WFA8433-Natural-Resource-Decision-Making/Course-Materials/_site"',     '"C:/Users/mcolvin/Documents/Teaching/WFA8433-Natural-Resource-Decision-Making/Docs"',     "/E /C /H /R /K /O /Y")) 

--></p>
<p><img src="media/banner-04.jpg" width="100%" /> <!--
Homework 1:  Introduction to basic computing- R
List of preliminary problems to instructor for review
--></p>
<div id="finishing-hlms-estimating-occupancy" class="section level1 unnumbered">
<h1>Finishing HLMs &amp; estimating occupancy</h1>
</div>
<div id="class-15-preliminaries" class="section level1">
<h1><span class="header-section-number">1</span> Class 15 preliminaries</h1>
<div id="housekeeping" class="section level2">
<h2><span class="header-section-number">1.1</span> Housekeeping</h2>
<ul>
<li>Dr. Mark Woodrey
<ul>
<li>Guest speaker-last 10 minutes of class</li>
<li>Application of Structured Decision Making to the Development of a Gulf of Mexico-wide Bird Monitoring Program March 10th at 11 am. Tully Auditorium.</li>
</ul></li>
<li>Supplemental background reading(s):
<ul>
<li>Powell and Gale. Chapter 15: Occupancy Modeling <a href="http://media.wix.com/ugd/95e73b_431c4d6ee6c6475d909dc90a766ae185.pdf">here</a></li>
<li>Welsh, A. H., D. B. Lindenmayer, and C. F. Donnelly. 2013. Fitting and Interpreting Occupancy Models. Plos One 8:e52015.[pdfs/W202.pdf]</li>
<li>Guillera-Arroita, G., J. J. Lahoz-Monfort, D. I. MacKenzie, B. A. Wintle, and M. A. McCarthy. 2014. Ignoring Imperfect Detection in Biological Surveys Is Dangerous: A Response to ‘Fitting and Interpreting Occupancy Models’. Plos One 9:e99571.[pdfs/G140.pdf]</li>
<li>Welsh, A. H., D. B. Lindenmayer, and C. F. Donnelly. 2015. Adjusting for One Issue while Ignoring Others Can Make Things Worse. Plos One 10:e0120817. [pdfs/W203.pdf]</li>
</ul></li>
<li>Assignment due: None</li>
<li>Class project: Think about decision model (objectives, nodes, utilities)</li>
<li>Link to class recording <a href="https://youtu.be/dQcjHnEuNKY">YouTube</a></li>
<li>Today’s R script <a href="scripts/Class-15.R">Class-15.R</a></li>
</ul>
</div>
<div id="class-overview-objectives" class="section level2">
<h2><span class="header-section-number">1.2</span> Class overview &amp; objectives</h2>
<p>This will be the last class the deals with predicting an outcome as a result of some inputs using a general or generalized linear model.</p>
<p>By the end of this class you should be able to:</p>
<ol style="list-style-type: decimal">
<li>Account for hierarchical dependence in linear model</li>
<li>Use upper level predictors in a hierarchical linear model.</li>
</ol>
</div>
<div id="preliminaries" class="section level2">
<h2><span class="header-section-number">1.3</span> Preliminaries</h2>
<ul>
<li>The R scipt for class can be found <a href="scripts/Class-15.R">here</a></li>
<li>Once you have the script where you want it it where you want open the R script and be sure to check the working directory <code>getwd()</code> and make sure it is where your folder is.</li>
<li>If your working directory is not correct, you can set it in Rstudio: “Session –&gt; Set Working Directory –&gt; To source file location”. Or you can use the <code>setwd()</code> in the console.</li>
</ul>
</div>
</div>
<div id="hlms-continued" class="section level1">
<h1><span class="header-section-number">2</span> HLMs continued</h1>
<div id="random-intercept-and-slopes" class="section level2">
<h2><span class="header-section-number">2.1</span> Random intercept and slopes</h2>
<p>Another instance we commonly run into is where we may have random intercepts and slopes. In other words we have heterogeneous intercepts and slopes. What does that remind you of? Well if you were thinking an about an interaction then, winner winner chicken dinner. However when we have many groups the number of parameters we estimate can quickly become numerous if we treat them as fixed effects. Additionally, it precludes us from making predictions beyond the groups in the model. However, random effects clears that up.</p>
<p>Let’s get some data rolling for a model that formally looks like this:</p>
<p><span class="math display">\[\mu_{i,j} = \beta_{0,j} + \beta_{1,j} \cdot X \]</span></p>
<p>and</p>
<p><span class="math display">\[\beta_{0,j} = \gamma + \epsilon\]</span> where</p>
<p>and</p>
<p><span class="math display">\[\beta_{1,j} = \delta + \tau\]</span></p>
<p>where</p>
<p><span class="math display">\[ \epsilon \sim Normal (0, \sigma_{\beta{0}})\]</span>,</p>
<p><span class="math display">\[ \tau \sim Normal (0, \sigma_{\beta{1}})\]</span>, and</p>
<p><span class="math display">\[Y_{i,j}\sim Normal(\mu_{i,j},\sigma)\]</span>.</p>
<p>The parameters in the equations above are:</p>
<p>Fixed effects:</p>
<ul>
<li><span class="math inline">\(\beta_{0,j}\)</span> is the group specific intercept</li>
<li><span class="math inline">\(\beta_{1,j}\)</span> is the group specific effect of <span class="math inline">\(X\)</span></li>
<li><span class="math inline">\(\gamma\)</span> is population mean intercept</li>
<li><span class="math inline">\(\delta\)</span> is the population mean slope</li>
</ul>
<p>Random effects:</p>
<ul>
<li><span class="math inline">\(\sigma_{\beta{0}}\)</span> is the standard deviation of group specific intercepts</li>
<li><span class="math inline">\(\sigma_{\beta{1}}\)</span> is the standard deviation of group specific slopes</li>
<li><span class="math inline">\(\sigma\)</span> is the standard deviation of the residuals</li>
</ul>
<p>Whoziers, 3 random effects, pulling a hat trick.</p>
<p>Data and predictions:</p>
<ul>
<li><span class="math inline">\(\mu_{i,j}\)</span>$ the expected outcome</li>
<li><span class="math inline">\(Y_{i,j}\)</span> is the observed data</li>
</ul>
<p>Indexes:</p>
<ul>
<li><span class="math inline">\(i\)</span> indexes observations</li>
<li><span class="math inline">\(j\)</span> indexes groups</li>
</ul>
<p>Let’s get this party started and build on our last dataset to get this beast rolling.</p>
<p>The code is the same as the heterogeneous intercept model.</p>
<p>Step 1 generate <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> and random effects.</p>
<pre class="r"><code>set.seed(8675309)

ngroups=50
beta0&lt;- 10
beta0&lt;- beta0+rnorm(ngroups,0,20) # random effect of group

beta1&lt;- 0.95
beta1&lt;- beta1+rnorm(ngroups,0,1.3) # random effect of group</code></pre>
<p>Now we can put them in a dataset to calculate predictions.</p>
<pre class="r"><code>dat&lt;- data.frame(
    beta0 = rep(beta0,30), 
    beta1= rep(beta1, 30), 
    group=rep(c(1:ngroups),30),
    x=runif(ngroups*30,10,50))
dat$group&lt;- as.factor(dat$group)</code></pre>
<p>And make our baseline predicted outcomes.</p>
<pre class="r"><code>dat$obs&lt;- dat$beta0+ dat$beta1*dat$x</code></pre>
<p>Ok now let’s gin up some random effects, 50*30 to be exact, one for each observation and add them to our baseline predicted outcomes. The <span class="math inline">\(\sigma\)</span> for this random effect is equal to 1.</p>
<pre class="r"><code>dat$obs&lt;- rnorm(ngroups*30,dat$obs,50)</code></pre>
<p>Just like the intercepts only but now we have a random effect around <span class="math inline">\(\beta_1\)</span>.</p>
<pre class="r"><code>library(lattice) # need for xypot
xyplot(obs~x,
    data=dat,
    group=group)</code></pre>
<p><img src="Class-15_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>That data looks good but messy! But thats where this gets fun. Uncertainty galore, uncertain outcomes, what is a decision maker to do but be in for a world of hurt? Nah, we can fit the model we described above.</p>
<pre class="r"><code>library(lme4)
fit&lt;- lmer(obs~x + (1+x|group), dat)
summary(fit)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: obs ~ x + (1 + x | group)
##    Data: dat
## 
## REML criterion at convergence: 16235.6
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.8152 -0.7037  0.0058  0.6877  3.4316 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  group    (Intercept)  192.87  13.888       
##           x              1.47   1.212   0.22
##  Residual             2642.56  51.406       
## Number of obs: 1500, groups:  group, 50
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  12.3809     4.1719   2.968
## x             0.9595     0.2071   4.633
## 
## Correlation of Fixed Effects:
##   (Intr)
## x -0.376</code></pre>
<p>Our estimates of the random effects are legit close to the values we fed the simulated data. And the fixed effects are close!</p>
<p>But what does it all mean? Well there is lots of uncertainty as we saw in the plot some groups go up some go down which makes for a difficult time of predicting outcomes with any certainty.</p>
<p>What if we could predict the random effects using a group level variable? Yes, Yes you can…</p>
</div>
<div id="predicting-random-effects" class="section level2">
<h2><span class="header-section-number">2.2</span> Predicting random effects</h2>
<p>Here we have a dataset with heterogeneous intercepts but for simplicity the the slopes will be homogeneous. This type of data might arise with hierarchically structured data, which I commonly encounter in streams. Specifically streams are nested within watershed. Suppose in this case we have a response variable where we have multiple observations within a watershed and there are 35 watersheds with data. The catchment size of the watershed vary and can be used to predict the intercept of watershed specific intercepts. Formally we are looking at a model defined as:</p>
<p><span class="math display">\[\mu_{i,j} = \beta_{0,j} + \beta_{1} \cdot X \]</span></p>
<p>and</p>
<p><span class="math display">\[\beta_{0,j} = \gamma + \nu \cdot \text{Catchment Size} + \epsilon\]</span></p>
<p>where</p>
<p><span class="math display">\[ \epsilon \sim Normal (0, \sigma_{\beta{0}})\]</span></p>
<p>and</p>
<p><span class="math display">\[Y_{i,j}\sim Normal(\mu_{i,j},\sigma)\]</span></p>
<p>The key is in the middle where we are now predicting <span class="math inline">\(\beta_{0,j}\)</span> using a linear model!</p>
<p>Ok let’s simulate a dataset to verify our understanding.</p>
<pre class="r"><code>nwatersheds&lt;- 35

# A WATERSHED LEVEL COVARIATE
catchmentSize&lt;- c(213,91,326,30,267,
    216,178,167,251,261,139,400,399,  
    56,261,34,90,108,224,312,85,64,
    254,188,266,95,391,327,351,314,
    211,305,170,273,253)</code></pre>
<p>Now lets specify <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\nu\)</span> for the wateshed level equation.</p>
<pre class="r"><code>beta0_ws&lt;- 5
beta1_ws&lt;- 0.8</code></pre>
<p>Now we can add the random effect (<span class="math inline">\(\epsilon\)</span> to the intercept where the random effect is normally distributed with mean 0 and a standard deviation of 55.</p>
<pre class="r"><code>beta0&lt;- beta0_ws +beta1_ws*catchmentSize + rnorm(nwatersheds,0,55)</code></pre>
<p>Let’s see what the intercepts look like.</p>
<pre class="r"><code>plot(catchmentSize,beta0,
    xlab=&quot;Catchment size&quot;,
    ylab=&quot;Intercept value&quot;)</code></pre>
<p><img src="Class-15_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Suppose there are 80 sites within each watershed. We can cobble together the predictors now.</p>
<pre class="r"><code>withinsites&lt;- 80
dat&lt;- data.frame(
    beta0 = rep(beta0,withinsites), 
    beta1= -3.6, 
    group=rep(c(1:nwatersheds),withinsites),
    catchmentSize=rep(catchmentSize,withinsites),
    x=runif(nwatersheds*withinsites,10,50))
dat$group&lt;- as.factor(dat$group)</code></pre>
<p>And generate the predictions</p>
<pre class="r"><code>dat$y&lt;- dat$beta0 + dat$beta1*dat$x</code></pre>
<p>and layer on the last bit of uncertainty</p>
<pre class="r"><code>dat$obs&lt;- rnorm(nrow(dat),dat$y,15)</code></pre>
<p>Let’s look at the mess we created.</p>
<pre class="r"><code>xyplot(obs~x,
    data=dat,
    xlab=&quot;Catchment size&quot;,
    ylab=&quot;Intercept value&quot;,
    group=group)</code></pre>
<p><img src="Class-15_files/figure-html/unnamed-chunk-15-1.png" width="672" /> Now we can use the <code>lmer()</code> to fit the model. The key here is that we include <code>catchmentSize</code> as a predictor in the model and because we specified heterogeneous intercepts and the catchment values are structured by group it ends up predicting <span class="math inline">\(\nu\)</span>.</p>
<pre class="r"><code>fit&lt;- lmer(obs~x+ catchmentSize + (1|group) , dat)
summary(fit)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: obs ~ x + catchmentSize + (1 | group)
##    Data: dat
## 
## REML criterion at convergence: 23337.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.5497 -0.6585 -0.0082  0.6656  2.9729 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  group    (Intercept) 3308.5   57.52   
##  Residual              223.3   14.94   
## Number of obs: 2800, groups:  group, 35
## 
## Fixed effects:
##               Estimate Std. Error t value
## (Intercept)   24.13267   22.23554    1.09
## x             -3.60441    0.02484 -145.08
## catchmentSize  0.80106    0.09239    8.67
## 
## Correlation of Fixed Effects:
##             (Intr) x     
## x           -0.033       
## catchmentSz -0.899  0.000</code></pre>
<p>Oh boy, it worked.</p>
<pre class="r"><code>fixef(fit)</code></pre>
<pre><code>##   (Intercept)             x catchmentSize 
##    24.1326734    -3.6044067     0.8010562</code></pre>
<p>Those are pretty close to the values we used!</p>
<p>The intercept is a bit off, but what do you expect we put a big chunk of uncertainty around it, <span class="math inline">\(\sigma\)</span>=55 as I recall.</p>
</div>
</div>
<div id="estimating-current-states-occupancy" class="section level1">
<h1><span class="header-section-number">3</span> Estimating Current States-Occupancy</h1>
<div id="background" class="section level2">
<h2><span class="header-section-number">3.1</span> Background</h2>
<p>Suppose you are out in the field at a specific location (note-occupancy makes inference about the site being occupied or not) and you repeated sample that site for a critter. It is likely you do not perfectly detect that critter if it is there, but you can detect it with some probability. Lets assume you can perfectly detect the critter then the detection history would be 1111 if you went out on 4 occasions. If you have imperfect detection, let’s define detection probability as <span class="math inline">\(p\)</span>, then there is some probability you might miss detecting the critter even if it is there. Now that brings up a the foundation of occupancy analysis, you can miss a critter for 2 reasons: 1) that critter was not there to begin with (i.e., was not occupying the site) or 2) the critter was there (i.e., was occupying the site) but you did not detect it. These 2 sources of 0s in a detection history can either be a true negative (reason 1 above) or a false negative (reason 2 above).</p>
</div>
<div id="probability-of-a-site-being-occupied" class="section level2">
<h2><span class="header-section-number">3.2</span> Probability of a site being occupied</h2>
<p>In this context, occupancy as we observe it, is a 0 or 1. However as we think about occupancy or try to model occupancy it is done as a probability. Lets define the probability of a site being occupied as <span class="math inline">\(\psi\)</span>. Let’s assume that we can detect our critter perfectly and <span class="math inline">\(p = 1\)</span>. Now, if we have a <span class="math inline">\(\psi = 0.35\)</span>, the probability of site not being occupied is <span class="math inline">\(1=\psi\)</span> or 1-0.35 = 0.65. Recall that occupancy is site or habitat specific and therefore the true site occupancy status (0 or 1) and therefore occupancy for 10 sites might be 111000000 for 10 sites given a <span class="math inline">\(\psi = 0.35\)</span>. We can actually simulate this easily in r. Suppose there are potential 3000 sites to sample in a large tract of land (i.e., the sampling domain). But we can only sample 35 of those sites due to budget limitations. Lets simulate this to see how things play out</p>
</div>
<div id="corn-in-a-rice-field" class="section level2">
<h2><span class="header-section-number">3.3</span> Corn in a rice field</h2>
<p>The graphic below illustrates a situation where it may be hard to detect an occurrence. Specifically there is a popcorn kernel in the bag of rice. We will work through an exercise to generate some data and estimate occupancy.</p>
<p><img src="media/20170308_110321.jpg" width="50%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>#install.packages(&quot;unmarked&quot;)
library(unmarked)</code></pre>
<pre><code>## Warning: package &#39;unmarked&#39; was built under R version 3.1.3</code></pre>
<pre><code>## Loading required package: reshape</code></pre>
<pre><code>## 
## Attaching package: &#39;reshape&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:Matrix&#39;:
## 
##     expand</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## Warning: package &#39;Rcpp&#39; was built under R version 3.1.3</code></pre>
<pre><code>## 
## Attaching package: &#39;unmarked&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     ranef</code></pre>
<p>Now we need to get our detections into a matrix for unmarked. In this example we don’t have any covariates so the <code>siteCovs</code> and the <code>obsCovs</code> are set to <code>NULL</code>.</p>
<pre class="r"><code>#detections&lt;- matrix(c(),nrow=6, ncol=???)
#detections&lt;-  unmarkedFrameOccu(detections, siteCovs=NULL, obsCovs=NULL)
#detections</code></pre>
<p>Now we can use the <code>occu()</code> function to estimate occupancy</p>
<pre class="r"><code>#fit &lt;- occu(~ 1 ~ 1, detections)
#fit
#backTransform(fit, type=&quot;state&quot;)
#backTransform(fit, type=&quot;det&quot;)</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
